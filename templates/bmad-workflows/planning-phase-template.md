# Planning Phase Workflow Template

## Overview
Template for executing the complete BMAD planning phase with all agent coordination and shared file management.

## Phase Structure
**Duration**: 45-60 minutes  
**Agents**: Analyst → PM → Architect → PO  
**Deliverables**: Complete technical planning with shared artifacts

## Workflow Execution

### 1. Initialize Planning Phase
```bash
#!/bin/bash
# initialize-planning.sh

# Set up shared workspace
mkdir -p docs tasks/{current-sprint,backlog,completed} logs .bmad-core/backups

# Initialize workflow state
cat > .bmad-core/workflow-state.json << EOF
{
  "currentPhase": "planning",
  "activeAgent": "analyst",
  "status": "active",
  "startTime": "$(date -Iseconds)",
  "sharedContext": {
    "projectName": "${PROJECT_NAME:-new-project}",
    "workspace": "$(pwd)",
    "artifacts": []
  },
  "agentQueue": ["analyst", "pm", "architect", "po"],
  "nextAgent": "analyst"
}
EOF

# Log phase start
echo "$(date): PHASE_START planning phase initialized" >> logs/workflow-progress.log
echo "$(date): Planning phase started with agents: analyst, pm, architect, po" >> .claude/agent-activity.log
```

### 2. Agent Execution Templates

#### A. Analyst Agent (`/analyst`)
**Deliverable**: `docs/project-brief.md`

```bash
#!/bin/bash
# analyst-workflow.sh

# Validate planning phase readiness
if [ "$(jq -r '.currentPhase' .bmad-core/workflow-state.json)" != "planning" ]; then
    echo "Error: Not in planning phase"
    exit 1
fi

# Update state to active analyst
jq '.activeAgent = "analyst" | .status = "executing"' .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

echo "$(date): ANALYST_START Market research and project brief creation" >> logs/workflow-progress.log

# Execute analyst tasks
# 1. Market Analysis
# 2. Competitive Research  
# 3. Project Brief Creation

# Create project brief template
cat > docs/project-brief.md << EOF
# Project Brief: ${PROJECT_NAME}

## Executive Summary
[Generated by Analyst Agent - $(date)]

## Market Analysis
### Target Market
- Primary audience:
- Market size:
- Growth potential:

### Competitive Landscape
- Key competitors:
- Market gaps:
- Opportunities:

## Project Scope
### Core Objectives
- Primary goal:
- Success metrics:
- Timeline:

### Constraints
- Budget limitations:
- Technical constraints:
- Resource availability:

## Next Steps
- Handoff to PM for requirements gathering
- Technical feasibility assessment needed
- Resource allocation planning required

---
*Generated by BMAD Analyst Agent on $(date)*
EOF

# Update workflow state and handoff
jq '.sharedContext.artifacts += ["docs/project-brief.md"] | .nextAgent = "pm" | .completedAgents += ["analyst"]' \
   .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

# Log handoff
echo "$(date): HANDOFF analyst -> pm: Project brief complete" >> logs/agent-interactions.log
echo "$(date): ANALYST_COMPLETE Project brief created successfully" >> logs/workflow-progress.log
```

#### B. Product Manager Agent (`/pm`)
**Deliverables**: `docs/requirements.md`, `docs/prd.md`

```bash
#!/bin/bash
# pm-workflow.sh

# Validate analyst handoff
if [ ! -f "docs/project-brief.md" ]; then
    echo "Error: Project brief not found - analyst handoff incomplete"
    exit 1
fi

# Update state to active PM
jq '.activeAgent = "pm" | .status = "executing"' .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

echo "$(date): PM_START Requirements gathering and PRD creation" >> logs/workflow-progress.log

# Create requirements document
cat > docs/requirements.md << EOF
# Requirements Document: ${PROJECT_NAME}

## Functional Requirements
[Generated by PM Agent - $(date)]

### Core Features
1. **Feature Set A**
   - Requirement 1:
   - Requirement 2:
   - Requirement 3:

2. **Feature Set B**
   - Requirement 1:
   - Requirement 2:

### User Stories
- As a [user type], I want [functionality] so that [benefit]
- As a [user type], I want [functionality] so that [benefit]

## Non-Functional Requirements
### Performance
- Response time: < 2 seconds
- Throughput: 1000+ concurrent users
- Availability: 99.9% uptime

### Security
- Authentication required
- Data encryption at rest
- GDPR compliance

### Scalability
- Horizontal scaling capability
- Database optimization
- CDN integration

## Acceptance Criteria
- [ ] All functional requirements met
- [ ] Performance benchmarks achieved
- [ ] Security audit passed
- [ ] User testing completed

---
*Generated by BMAD PM Agent on $(date)*
EOF

# Create PRD
cat > docs/prd.md << EOF
# Product Requirements Document: ${PROJECT_NAME}

## Product Overview
[Generated by PM Agent - $(date)]

### Vision Statement
[Product vision and long-term goals]

### Target Users
- Primary: [User segment 1]
- Secondary: [User segment 2]
- Edge cases: [User segment 3]

## Feature Specifications
### Epic 1: [Epic Name]
**Priority**: High
**Effort**: 5 points
**Dependencies**: None

#### User Stories
- Story 1: [Description]
- Story 2: [Description]

#### Acceptance Criteria
- [ ] Criteria 1
- [ ] Criteria 2

### Epic 2: [Epic Name]
**Priority**: Medium  
**Effort**: 3 points
**Dependencies**: Epic 1

## Success Metrics
- KPI 1: [Metric and target]
- KPI 2: [Metric and target]
- KPI 3: [Metric and target]

## Release Planning
### Phase 1 (MVP)
- Timeline: [Date range]
- Features: [Core features]

### Phase 2 (Enhancement)
- Timeline: [Date range]
- Features: [Additional features]

---
*Generated by BMAD PM Agent on $(date)*
EOF

# Update workflow state and handoff
jq '.sharedContext.artifacts += ["docs/requirements.md", "docs/prd.md"] | .nextAgent = "architect" | .completedAgents += ["pm"]' \
   .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

# Log handoff
echo "$(date): HANDOFF pm -> architect: Requirements and PRD complete" >> logs/agent-interactions.log
echo "$(date): PM_COMPLETE Requirements and PRD created successfully" >> logs/workflow-progress.log
```

#### C. Architect Agent (`/architect`)
**Deliverable**: `docs/technical-design.md`

```bash
#!/bin/bash
# architect-workflow.sh

# Validate PM handoff
if [ ! -f "docs/requirements.md" ] || [ ! -f "docs/prd.md" ]; then
    echo "Error: Requirements or PRD not found - PM handoff incomplete"
    exit 1
fi

# Update state to active architect
jq '.activeAgent = "architect" | .status = "executing"' .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

echo "$(date): ARCHITECT_START Technical design and architecture planning" >> logs/workflow-progress.log

# Create technical design document
cat > docs/technical-design.md << EOF
# Technical Design Document: ${PROJECT_NAME}

## Architecture Overview
[Generated by Architect Agent - $(date)]

### System Architecture
\`\`\`
[Frontend] ↔ [API Gateway] ↔ [Backend Services] ↔ [Database]
     ↓              ↓              ↓            ↓
[Static Assets] [Load Balancer] [Microservices] [Cache Layer]
\`\`\`

### Technology Stack
#### Frontend
- Framework: [React/Vue/Angular]
- Build Tool: [Vite/Webpack]
- Styling: [CSS/Sass/Styled-components]
- Testing: [Jest/Cypress]

#### Backend
- Runtime: [Node.js/Python/Java]
- Framework: [Express/FastAPI/Spring]
- Database: [PostgreSQL/MongoDB]
- Cache: [Redis/Memcached]

#### Infrastructure
- Cloud: [AWS/GCP/Azure]
- Containers: [Docker/Kubernetes]
- CI/CD: [GitHub Actions/Jenkins]
- Monitoring: [DataDog/New Relic]

## Component Design

### Core Components
1. **Authentication Service**
   - JWT token management
   - OAuth integration
   - Session handling

2. **Business Logic Layer**
   - Service classes
   - Validation logic
   - Business rules

3. **Data Access Layer**
   - Repository pattern
   - Database connections
   - Query optimization

### API Design
#### RESTful Endpoints
\`\`\`
GET    /api/v1/users
POST   /api/v1/users
PUT    /api/v1/users/:id
DELETE /api/v1/users/:id
\`\`\`

#### GraphQL Schema (if applicable)
\`\`\`graphql
type User {
  id: ID!
  name: String!
  email: String!
}
\`\`\`

## Data Model

### Database Schema
#### Users Table
\`\`\`sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(255) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
\`\`\`

### Data Flow
1. Client request → API Gateway
2. Authentication → Business Logic
3. Data Processing → Database
4. Response → Client

## Security Considerations
- Input validation and sanitization
- SQL injection prevention
- XSS protection
- CSRF tokens
- Rate limiting
- Encryption at rest and in transit

## Performance Optimization
- Database indexing strategy
- Caching implementation
- CDN configuration
- Code splitting
- Lazy loading

## Deployment Strategy
### Development Environment
- Local development setup
- Docker compose configuration
- Hot reloading enabled

### Production Environment
- Load balancing configuration
- Database clustering
- Automated backups
- Monitoring and alerting

## Migration Plan
1. Infrastructure setup
2. Database migration
3. Service deployment
4. DNS configuration
5. SSL certificate setup

---
*Generated by BMAD Architect Agent on $(date)*
EOF

# Update workflow state and handoff
jq '.sharedContext.artifacts += ["docs/technical-design.md"] | .nextAgent = "po" | .completedAgents += ["architect"]' \
   .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

# Log handoff
echo "$(date): HANDOFF architect -> po: Technical design complete" >> logs/agent-interactions.log
echo "$(date): ARCHITECT_COMPLETE Technical design created successfully" >> logs/workflow-progress.log
```

#### D. Product Owner Agent (`/po`)
**Deliverables**: `tasks/epics.md`, Sprint planning

```bash
#!/bin/bash
# po-workflow.sh

# Validate architect handoff
if [ ! -f "docs/technical-design.md" ]; then
    echo "Error: Technical design not found - architect handoff incomplete"
    exit 1
fi

# Update state to active PO
jq '.activeAgent = "po" | .status = "executing"' .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

echo "$(date): PO_START Epic breakdown and sprint planning" >> logs/workflow-progress.log

# Create epic breakdown
cat > tasks/epics.md << EOF
# Epic Breakdown: ${PROJECT_NAME}

## Epic Planning Overview
[Generated by PO Agent - $(date)]

### Epic 1: User Authentication System
**Priority**: P0 (Critical)
**Story Points**: 13
**Sprint**: 1-2

#### User Stories
1. **User Registration**
   - As a new user, I want to create an account so that I can access the platform
   - Acceptance Criteria:
     - [ ] Email validation required
     - [ ] Password strength requirements
     - [ ] Email confirmation process
   - **Points**: 5

2. **User Login**
   - As a registered user, I want to log in so that I can access my account
   - Acceptance Criteria:
     - [ ] Email/password authentication
     - [ ] Remember me option
     - [ ] Password reset functionality
   - **Points**: 3

3. **Session Management**
   - As a logged-in user, I want my session to persist so that I don't need to re-authenticate frequently
   - Acceptance Criteria:
     - [ ] JWT token implementation
     - [ ] Token refresh mechanism
     - [ ] Secure logout
   - **Points**: 5

### Epic 2: Core Platform Features
**Priority**: P1 (High)
**Story Points**: 21
**Sprint**: 3-4

#### User Stories
1. **Dashboard Creation**
   - As a user, I want a personal dashboard so that I can overview my activity
   - **Points**: 8

2. **Data Management**
   - As a user, I want to manage my data so that I can organize my information
   - **Points**: 8

3. **Settings Configuration**
   - As a user, I want to configure my preferences so that I can customize my experience
   - **Points**: 5

### Epic 3: Advanced Features
**Priority**: P2 (Medium)
**Story Points**: 18
**Sprint**: 5-6

#### User Stories
1. **Reporting System**
   - As a user, I want to generate reports so that I can analyze my data
   - **Points**: 8

2. **Integration APIs**
   - As a developer, I want API access so that I can integrate with external systems
   - **Points**: 10

## Sprint Planning

### Sprint 1 (Week 1-2)
**Goal**: Establish foundation with authentication
**Capacity**: 15 story points

#### Planned Stories
- User Registration (5 pts)
- User Login (3 pts) 
- Session Management (5 pts)
- Development Environment Setup (2 pts)

#### Definition of Done
- [ ] All acceptance criteria met
- [ ] Unit tests written and passing
- [ ] Code reviewed and approved
- [ ] Documentation updated

### Sprint 2 (Week 3-4)
**Goal**: Complete authentication system
**Capacity**: 15 story points

#### Planned Stories
- Authentication system refinement (8 pts)
- Password reset functionality (5 pts)
- Security hardening (2 pts)

### Sprint 3 (Week 5-6)
**Goal**: Begin core platform development
**Capacity**: 15 story points

#### Planned Stories
- Dashboard Creation start (8 pts)
- Basic data models (4 pts)
- UI framework setup (3 pts)

## Backlog Prioritization
1. **Must Have (P0)**: Authentication, Core CRUD operations
2. **Should Have (P1)**: Dashboard, Advanced features
3. **Could Have (P2)**: Integrations, Reporting
4. **Won't Have This Release**: Advanced analytics

## Success Metrics
- Sprint velocity: 15 pts/sprint target
- Bug escape rate: < 5%
- User story completion: 100%
- Technical debt: < 20% of capacity

---
*Generated by BMAD PO Agent on $(date)*
EOF

# Create initial backlog
mkdir -p tasks/current-sprint tasks/backlog tasks/completed

# Create current sprint tasks
cat > tasks/current-sprint/sprint-1.md << EOF
# Sprint 1: Foundation & Authentication

## Sprint Goal
Establish project foundation and implement core authentication system.

## Sprint Backlog
- [ ] User Registration (5 pts) - IN PROGRESS
- [ ] User Login (3 pts) - TODO
- [ ] Session Management (5 pts) - TODO
- [ ] Development Environment (2 pts) - DONE

## Daily Standups
### Day 1
- Started user registration implementation
- Set up development environment
- No blockers

## Sprint Review Preparation
- [ ] Demo user registration flow
- [ ] Show development environment setup
- [ ] Present login implementation progress

---
*Updated by BMAD PO Agent on $(date)*
EOF

# Update workflow state - planning complete
jq '.currentPhase = "planning-complete" | .status = "completed" | .completedAgents += ["po"] | .sharedContext.artifacts += ["tasks/epics.md"] | .nextPhase = "development"' \
   .bmad-core/workflow-state.json > temp.json
mv temp.json .bmad-core/workflow-state.json

# Log planning completion
echo "$(date): PLANNING_COMPLETE All agents finished, ready for development phase" >> logs/agent-interactions.log
echo "$(date): PO_COMPLETE Epic breakdown and sprint planning complete" >> logs/workflow-progress.log
```

## Usage Instructions

### 1. Execute Complete Planning Phase
```bash
# Run the full planning workflow
cd my-dev-workspace
export PROJECT_NAME="my-new-project"

# Initialize planning
./templates/bmad-workflows/initialize-planning.sh

# Execute agent sequence
./templates/bmad-workflows/analyst-workflow.sh
./templates/bmad-workflows/pm-workflow.sh  
./templates/bmad-workflows/architect-workflow.sh
./templates/bmad-workflows/po-workflow.sh

# Verify completion
echo "Planning phase artifacts created:"
ls -la docs/ tasks/
```

### 2. Using with Claude Code
```bash
# Alternative: Use BMAD agents through Claude Code
/analyst "Create project brief for ${PROJECT_NAME}"
/pm "Generate requirements from project brief" 
/architect "Design technical architecture"
/po "Create epic breakdown and sprint plan"
```

### 3. Monitor Workflow Progress
```bash
# Check workflow state
cat .bmad-core/workflow-state.json | jq .

# Monitor agent activity
tail -f .claude/agent-activity.log

# View agent interactions
tail -f logs/agent-interactions.log
```

## Customization

### Environment Variables
- `PROJECT_NAME`: Set project name for all templates
- `SPRINT_CAPACITY`: Override default sprint capacity (15 pts)
- `TEAM_SIZE`: Adjust templates for team size

### Template Modifications
- Edit individual agent scripts for custom workflows
- Modify artifact templates in each agent script
- Adjust sprint planning parameters in PO workflow

This template ensures all BMAD agents work with the same shared files and maintain consistent state throughout the planning phase.